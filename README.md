# EffectiveMobile
Тестовое задание в Effective Mobile

Реализовать сервис, который будет получать поток ФИО, из открытых апи обогащать
ответ наиболее вероятными возрастом, полом и национальностью и сохранять данные в
БД. По запросу выдавать инфу о найденных людях. Необходимо реализовать следующее
1. Сервис слушает очередь кафки FIO, в котором приходит информация с ФИО в
формате
```
{
"name": "Dmitriy",
"surname": "Ushakov",
"patronymic": "Vasilevich" // необязательно
}
```
2. В случае некорректного сообщения, обогатить его причиной ошибки (нет
обязательного поля, некорректный формат...) и отправить в очередь кафки
FIO_FAILED
3. Корректное сообщение обогатить
    1. Возрастом - https://api.agify.io/?name=Dmitriy
    2. Полом - https://api.genderize.io/?name=Dmitriy
    3. Национальностью - https://api.nationalize.io/?name=Dmitriy
4. Обогащенное сообщение положить в БД postgres (структура БД должна быть создана
путем миграций)
5. Выставить rest методы
    1. Для получения данных с различными фильтрами и пагинацией
    2. Для добавления новых людей
    3. Для удаления по идентификатору
    4. Для изменения сущности
6. Выставить GraphQL методы аналогичные п.5
7. Предусмотреть кэширование данных в redis
8. Покрыть код логами
9. Покрыть бизнес-логику unit-тестами
10. Вынести все конфигурационные данные в .env


## :open_file_folder: Структура репозитория

- `cmd/main.go` - главный файл, в котором запускается сервер http/graphql/kafka
- `config` - папка с конфигом
- `entity` - папка с сущностями
- `internal` - папка с кодом проекта
    - `graph` - папка со схемами GraphQL
        - `model/models_gen.go` - сгенерированные на базе GraphQL-схем модели (Go-шные структуры)
        - `generated.go` - сгенерированный код gqlgen
        - `resolver.go` - структура Resolver-а (собирает в себе storage-ы)
        - `schema.graphqls` - схема graphql
        - `schema.resolver.go` - бизнес логика
        - `server` - сервер graphql
    - `http` - папка с rest ручками
        - `handler.go` - файл с ручками
        - `response.go` - файл со структурой respons
        - `server.go` - http сервер для rest api
    - `kafka` - папка с kafka consumer
    - `repository` - папка с уровнем storage
        - `mocks` - папка с моками
        - `cache.go` - файл с методами для кэширования Redis
        - `postgres.go` - бд Postgres
        - `redis.go` - бд Redis
        - `repository.go` - файл с интерфесами для репозитория
        - `user.go` - методы для бд
    - `service` - папка с бизнес логикой
        - `service.go` - файл с интерфейсами для сервиса
        - `user.go` - бизнес логика для User
        - `user_test.go` - тесты для User
- `migrations` - папка с миграциями, `Dockerfile`-ом и `.sh`-скриптом для их накатывания на БД
- `gqlgen.yml` - настройки генерации Go-шного кода по GraphQL схемам
- `Makefile` - обычный Makefile с различными командами для запуска сервера
- `docker-compose.yaml` - docker-compose для запуска контейнеров(postgres, redis, api)
- `Dockerfile` - Dockerfile для запуска сервера в докер-контейнере

## :hammer: Запуск

docker compose up --build

make migrations-up
(__необходимо установить go migrate__)
